## 오늘 한 일
**카카오 소셜 로그인**
- 전체적인 흐름 
카카오로부터 인가코드를 받고 받은 인가코드를 백엔드에 넘겨줘서 백엔드로부터 우리 사이트 전용 토큰을 발급받음
![](https://velog.velcdn.com/images/hongsoom/post/f5b1c2f2-8e72-4ea0-836c-fb925804a5a5/image.png)

---------
**1. 인가 코드 받기**

```javascript
"https://kauth.kakao.com/oauth/authorize?client_id={REST_API_KEY}&redirect_uri={REDIRECT_URI}&response_type=code"
```
이 주소로 접근을 하면 인가 코드를 받아올 수 있게 된다.

- **cliend_id**
kakao developers에서 내 애플리케이션을 추가했을 때 생기는 REST_API 키
![](https://velog.velcdn.com/images/hongsoom/post/9b7bec34-7de4-45a3-a5a8-132cae8075fe/image.PNG)

- **Redirect URI**
 Redirect URI는 반드시 프론트에서 접근할 수 있는 Host로 지정해주어야 한다. (localhost:3000)

 왜냐하면 여기에서 인가 코드 받고 넘기고 등등 모든 작업이 이루어져야 하는데 프론트엔드가 접근할 수 없는 Host로 지정을 해버리면 말 그대로 접근을 못하니 아무것도 할 수 없다.

 ![](https://velog.velcdn.com/images/hongsoom/post/8b5474be-ac1d-41a5-bb7e-c5d6d2e7f5a6/image.PNG)
 
 - **플랫폼 추가**
 Web에서 사용할 것이기 때문에 Web 플랫폼에 사이트 도메인을 추가한다.
배포하기 전이기 때문에 localhost:3000으로 설정했다.
 ![](https://velog.velcdn.com/images/hongsoom/post/c9750d95-1985-400f-9475-3b20e288f601/image.PNG)

➡ 모아 온 것들을 한 번에 편하게 관리하기 위해 컴포넌트를 새로 생성 **OAuth.js**
```javascript
const CLIENT_ID = "11111111111111111111111111111111";
const REDIRECT_URI =  "http://localhost:3000/oauth/callback/kakao";

export const KAKAO_AUTH_URL = `https://kauth.kakao.com/oauth/authorize?client_id=${CLIENT_ID}&redirect_uri=${REDIRECT_URI}&response_type=code`;
```

[카카오 계정 로그인] 버튼을 눌렀을 때 위에서 만든 URL 주소로 연결을 시켜주면 된다.

```javascript
// Login.js

import { KAKAO_AUTH_URL } from "../shared/OAuth";

 <div className="login-kakao">
 	<a href={KAKAO_AUTH_URL}>
    	<img src={Kakao_login} alt="kakao"/>
    </a>
</div>
```

그러면 버튼을 눌렀을때 카카오톡 로그인 화면으로 이동이 되고, 이메일-비밀번호를 입력하면 아래와 같이 동의하기 화면이 나온다.

![](https://velog.velcdn.com/images/hongsoom/post/c3427cde-2d0e-442f-835f-b621185bd52f/image.PNG)

동의하고 계속하기를 누르면 이동되는 화면이 **Redirect_URI 화면**

![](https://velog.velcdn.com/images/hongsoom/post/3bb34373-dadd-4ec8-829b-f701a8dc998f/image.PNG)

주소창을 보면 Redirect_URI 뒤에 파라미터로  ?code=@@@@@@@@@@@@@
인가 코드가 넘어온 것을 확인할 수 있다.

------------------


```javascript
// 리다이렉트될 화면
// KakaoSocial.js
import React from "react";
import { useDispatch } from "react-redux";
import { userAction } from "../redux/module/user";
import Spinner from "../components/Spinner";

const KakaoSocial = () => {
  const dispatch = useDispatch();
  
  let code = new URL(window.location.href).searchParams.get("code");
  console.log(code)

  React.useEffect(async () => {
    await dispatch(userAction.kakaoLoginDB(code));
  }, []);

  return <Spinner />
};

export default KakaoSocial;
```
- **let 변수명 = new URL(window.location.href).searchParams.get('code')**
URL 안에 search 파라미터에 들어있는 'code'라는 값을 get 하겠다.
이렇게 하면 '변수명'이라는 변수 안에 인가 코드 정보가 담기게 된다.


이 컴포넌트가 리다이렉트 되는 화면으로서 사용될 것이기 때문에 여기에 인가 코드를 받아오는 코드를 적어주었다.

그리고 네트워크가 느린 사용자들은 리다이렉팅 되는 화면을 무방비로 보게 될 것인데 이 화면이 그냥 하얀 화면이면 무슨 상황인지 사용자는 알 턱이 없고 당황할 수도 있기 때문에 spinner를 만들어 넣었다.

```javascript
import React from "react";
import { Route, Routes } from "react-router-dom";
import Write from "./pages/Write";
import Detail from "./pages/Detail";
import Signup from "./pages/Signup";
import Login from "./pages/Login";
import MyPage from "./pages/Mypage";
import Category from "./pages/Category";
import KakaoSocial from "./pages/KakaoSocial";
import Main from "./pages/Main";

function App() {

  
  return (
    <div className="App">
      <Routes>
        <Route path="/signup" element={<Signup />} />
        <Route path="/login" element={<Login />} />
        <Route path="/write" element={<Write />}/>
        <Route path="/detail" element={<Detail />} />
        <Route path="/" element={<Main />} />
        <Route path="/mypage" element={<MyPage />} />
        <Route path="/category" element={<Category />} />
        <Route path="/oauth/kakao/callback" element={<KakaoSocial />} />
      </Routes>
    </div>
  );
}

export default App;
```

---------------
**2. 인가 코드 백엔드에 넘기고 토큰 받기**
인가 코드를 받아오면 axios를 활용해 코드를 백엔드에게 넘겨준다.

```javascript
  const kakaoLoginDB = (code) => {
    return async function (dispatch) {
      try {
        const response = await instance.get(
          `api/user/kakaoLogin/callback?code=${code}`
        );
        console.log(response);
        if (response.status === 201) {
          const token = response.headers.authorization;
          localStorage.setItem("token", token);
        }
        if (localStorage.getItem("token")) {
          window.location.assign("/");
        } 
      } catch (err) {
        console.log(err)
      }
    };
  };
```
---------------------

하고 보니 프론트엔드는 과정이 생각보다 단순했다.
더 많은 것들을 도전해보고 찾아보면서 계속해서 경험치를 많이 쌓아보는 것이 답인 것 같다.